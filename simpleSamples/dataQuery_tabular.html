<html>

<head>
  <title>Data Query Example</title>

	<!-- Dependencies -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="http://XYZ YOUR ZOOMDATA SERVER HERE/zoomdata/sdk/2.0/zoomdata-client.js"></script>
  <link rel="stylesheet" type="text/css" href="simplesample.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/s/dt/jq-2.1.4,dt-1.10.10/datatables.min.css"/>
  <script type="text/javascript" src="https://cdn.datatables.net/s/dt/jq-2.1.4,dt-1.10.10/datatables.min.js"></script>

</head>



<body>

  <div style='float:left; width:50%; font-size:10pt; margin:15px; padding: 5px; border: black solid 1px'>
  <table class='dataTable' id='presentation' style='font-size:10pt'>
      <thead style='text-align:left;'>
        <tr>
          <th>City</th><th>Average Price</th>
        </tr>
      </thead>
                          <!--JS will insert data into dataContents-->
      <tbody id='dataContents'>
      </tbody>
    </table>
  </table>
</div>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin facilisis accumsan tincidunt. Mauris mauris ligula, faucibus vitae placerat a, faucibus elementum mi. Donec mi arcu, venenatis non accumsan at, hendrerit a elit. Proin eget felis ac metus cursus sagittis a in dui. Pellentesque at accumsan lorem. Vestibulum quis tincidunt orci. Curabitur nec lacus id erat volutpat vestibulum a vitae lacus. Ut vitae ornare neque. Curabitur ex sem, semper at urna non, gravida consequat nibh. Aliquam iaculis nunc nec sem eleifend posuere. Maecenas fringilla gravida libero, sit amet feugiat mi pharetra non. Fusce sodales posuere ante sed varius. Cras ex diam, tincidunt a commodo vel, varius eget purus. Donec vitae efficitur ligula. Nullam nec porttitor nibh. Donec in nulla eget enim aliquam tincidunt.</p>
<p>Integer feugiat rutrum tortor in dictum. Donec mi ante, posuere vel lorem elementum, rutrum efficitur diam. Curabitur pharetra semper sapien id lobortis. Nulla quis auctor dui. Vestibulum sed est tristique purus viverra faucibus. Donec sagittis tincidunt ex, et auctor lacus elementum nec. Fusce sagittis purus non purus faucibus laoreet. Donec porta lacinia mi, vitae commodo tortor egestas in.</p>
<p>Nulla vulputate risus egestas libero bibendum interdum. Cras vestibulum ipsum vel elit rhoncus tempus. Fusce vitae orci lobortis, auctor est nec, ultrices lectus. Donec ligula leo, finibus nec fermentum ac, efficitur ut mi. Praesent vitae orci fermentum risus fringilla malesuada imperdiet at libero. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Vestibulum sed ultrices turpis. Maecenas ultrices gravida condimentum. Fusce quis risus ullamcorper, imperdiet tellus at, bibendum tortor. Vestibulum sed feugiat lorem, sed viverra ipsum. Nunc congue lectus in ligula mattis, nec mollis turpis suscipit. Quisque molestie turpis sed rhoncus tincidunt. Suspendisse ut vehicula diam.</p>

  <!-- The JS code for the visualization specifies that it
  render on the HTML element with id='visualization'.-->

  <script type="text/javascript">

  // Application configuration settings
  // secure: a boolean value, with true indicating
  //    HTTPS should be used; false indicates HTTP
  // host: the URL of the Zoomdata server
  // port: the port used by the Zoomdata server
  // path: extension used by the Zoomdata server
  var applicationConfig = {
      secure: false,   
      host: 'XYZ - YOUR SERVER URL HERE',                
      port: XYZ - YOUR SERVER PORT HERE,                 
      path: 'XYZ - YOUR SERVER PATH HERE'
      };

    // Security parameters
    var credentialsConfig = {
      key: "XYZ - YOUR SECURITY KEY HERE"
    };

    // Query configuration parameters
    var queryConfig = {
       tz: 'EST',
       player: {
         speed: 1,
         pauseAfterRead: true,
         timeWindowScale: 'ROLLING'
       },
       time: {
         timeField: '_ts'
       },
       filters: [{
         path: 'price',
         operation: 'BETWEEN',
         value: [0,5]
       }],
       groups: [{
         name: 'usercity',
         limit: 200,
         sort: {
           dir: 'asc',
           name: 'usercity'
         }
       }],
       metrics: [{
         name: 'price',
         func: 'avg'
        }]
     }

      // Create the client
      ZoomdataSDK.createClient({                      
                    credentials: credentialsConfig,
                    application: applicationConfig
                })
                // Create the query
                .then( function(client) {
                        window.client = client;
                        return( client.createQuery('Real Time Sales', queryConfig) );
                })
                .then( function (result) {
                  // Run the query and output the values
                    return window.client.runQuery( result, function(queryData) {
                      console.log(queryData);
                      var numDatas = queryData.length;
                      var ctr;
                      var $newRow;
                      for (ctr=0; ctr<numDatas; ctr++) {
                        $newRow = $( "<tr><td>" + queryData[ctr].group[0] + "</td><td>$" + (queryData[ctr].current.metrics.price.avg).toFixed(2) + "</td></tr>" );
                        $( "#dataContents" ).append( $newRow );
                      }

                      // Apply pretty formatting to the table
                      $('#presentation').DataTable();
                    });
                })
                .catch( function (error) {
                  // The client library returns user friendly error messages
                  console.log( "Error: " + error );
                });

</script>

</body>

</html>
